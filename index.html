<!DOCTYPE HTML>

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		
		<link rel="stylesheet" type="text/css" href="css/theme.css">
		<link rel="stylesheet" type="text/css" href="css/scrollz.css">
		<link rel="stylesheet" type="text/css" href="css/jquery.mobile.min.css">
		<link href="font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet">
		
		<script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>

		
		<script src="js/jquery-2.1.1.min.js"></script>
		<script src="js/swipe.js"></script>

		
		<script type="text/javascript">

		
</script>


	</head>
	
	<body>
		<div class="header_demo">
		<img src='img/logo_smbank.png' style='height:36px;'></img>
			
		</div>
		
		<div class="principal_menu">
			<i class="fa fa-university active fa-fw" div="entity_tab"></i>
			<i class="fa fa-envelope-o  fa-fw"	div="message_tab" iconp="filter"></i>
			<i class="fa fa-flask fa-fw" div="github_tab"></i>
			<i class="fa fa-cogs fa-fw" div="config_tab"></i>
		</div>
		
		
		<div id='entity_tab' class='view active' style='text-align:center;'>
			<img src='img/icono-appriz.png' class='appriz_logo'/>
			<br>APPRIZ(R) 2014. Demo mobile API.</br>
		</div>
		
		<div id='message_tab' class='view'>
			<div style='width:100%;  ' class="internal_header"><p class='title' > Inbox</p></div>
		
		</div>
		
		<div id='github_tab' class='view'>
		<div style='width:100%;  ' class="internal_header"><p class='title' > Lab</p></div>
			
			<div class='refreshing_list'><i class="fa fa-spinner fa-spin"></i> Refreshing ...</div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='eyJHRVMwMDEiOiJDYWxsIG1lISIsIkdFUzAwMiI6ImNhbGwgeW91ISJ9'><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='eyJHRVMwMDEiOiJDYWxsIG1lISIsIkdFUzAwMiI6ImNhbGwgeW91ISJ9'><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='eyJHRVMwMDEiOiJDYWxsIG1lISIsIkdFUzAwMiI6ImNhbGwgeW91ISJ9'><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='eyJHRVMwMDEiOiJDYWxsIG1lISIsIkdFUzAwMiI6ImNhbGwgeW91ISJ9'><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div class='message unread' id='' longMSG="dead text bllblblba lbnlblb lblblb 00001" services='e30='><img src='img/ic_90_iPhone_ios7_myalerts.png'/><table><tr><td>Shor message go here</td></tr><tr><td><i class="fa fa-calendar"></i>12 jun 2014 16:00:00</td></tr></table></div>
			
		</div>
		
		<div id='config_tab' class='view'>
			<div style='width:100%;  ' class="internal_header"><p class='title' > Settings</p></div>
			<ul class="ui-listview ui-listview-inset ui-corner-all ui-shadow" data-role="listview" data-inset="true" style='background-color: #fefefe !important;'>
            </br>&nbsp;
			</br>&nbsp;
			<li class="ui-last-child" view='service_luncher'><a class="ui-btn-a ui-btn ui-btn-icon-right ui-icon-carat-r" data-form="ui-btn-up-a" data-swatch="a" data-theme="a" href="#"><i class="fa fa-rocket fa-fw"></i> Service luncher</a></li>
			</br>&nbsp;
			</br>&nbsp;
			
			<li class="ui-last-child" view='config_rules'><a class="ui-btn-a ui-btn ui-btn-icon-right ui-icon-carat-r" data-form="ui-btn-up-a" data-swatch="a" data-theme="a" href="#"><i class="fa fa-exclamation-triangle fa-fw"></i> Config my alerts</a></li>
		</ul>
			
		</div>
		
		<div id='detail_msg' class='view' iconp="back">
			<div style='width:100%;  ' class="internal_header"><p style="text-align: center; color: #1A73B6" id='shortMSG'> </p></div>
			<div class='div_content' >
				<img width='60px' class='typeIcon'></img>
				<p style="text-align: justify; color: #000" id='longMSG'></p>
			</div>
			<div style='width:100%;  ' class="internal_header"><i class="fa fa-history" style='margin-left: 8px;'></i>&nbsp;&nbsp;&nbsp;History<i class="fa fa-plus-square-o" style="position: absolute; right: 12px; margin-top: 7px;"></i> </div>
			<div class='div_content' style='display: none;'></div>
			<div style='width:100%;  ' class="internal_header"><i class="fa fa-random" style='margin-left: 8px;'></i>&nbsp;&nbsp;&nbsp;Transacctions<i class="fa fa-plus-square-o" style="position: absolute; right: 12px; margin-top: 7px;"></i> </div>
			<div class='div_content' style='display: none;'></div>
			
			 
			 <div class='management'><ul>
				 </ul></div>
				 <a href="#" class="ui-btn mng" onclick="$('.management').toggle();">management </a>
			</div>
			
		<div id='config_rules' class='view' iconp="back">
			<div style='width:100%;  ' class="internal_header"><p class='title' > My Alerts</p></div>
				<div style='width:100%; height :100%; overflow: auto !important; ' id='rules_div'>
					<div class='rule'>
						<div class='rule_header'>
							<div class='rule_header_txt'><p>Ejemplo de Regla con descripcion larga ghffghf hg hfhgfh fg </p></div>
							
							<input type="checkbox" name="toggle2" id="toggle2" class='toggle'>
							<label for="toggle2"></label>
						</div>
						<div class='rule_body'>
						 fddf
						</div>
					</div>
					<div class='rule'>
						<div class='rule_header'>
							<div class='rule_header_txt'><p>Ejemplo de Regla con descripcion corta </p></div>
							
							<input type="checkbox" name="toggle" id="toggle" class='toggle'>
							<label for="toggle"></label>
						</div>
						<div class='rule_body'>
						 <p align='justify' style='100%'> Notificarme cuando se realizen <trxNo>3</trxNo> en supermercados por un monto acumulado de <totalAmount>10000</totalAmount> MX en un lapso de <time>30 minutos</time>.</p>
							<table>
								<tr><th>Amount</th><td><input type='number' field='totalAmount' maxlength="10"/></td></tr>
								<tr><th>Count</th><td><input type='number' field='trxNo' maxlength="10"/></td></tr>
								<tr><th>time</th><td><input type='number' field='time' maxlength="10"/></td></tr>
							</table>
						</div>
					</div>
				</div>
			
		</div>
		
		<div id='service_luncher' class='view' iconp="back">
			<div style='width:100%;  ' class="internal_header"><p class='title' > Services</p></div>
		</div>
		
		<div class='vertical_menu'>
			<ul>
				
				<li><img src='img/ic_90_iPhone_ios7_myalerts.png'/><div>My Alerts</div> <i class="fa fa-check-square-o"></i></li>
				<li><img src='img/ic_90_iPhone_ios7_alerts.png'/><div>Alerts</div> <i class="fa fa-check-square-o"></i></li>
				<li><img src='img/ic_90_iPhone_ios7_notific.png'/><div>Notifications</div> <i class="fa fa-check-square-o"></i></li>
				<li><img src='img/ic_90_iPhone_ios7_publicidad.png'/><div>Promotions</div> <i class="fa fa-check-square-o"></i></li>
		
				<li ><img src='img/FFFFFF-1.png'/><div>Read </div> <i class="fa fa-check-square-o"></i></li>
				<li><img src='img/FFFFFF-1.png'/><div>Unread</div> <i class="fa fa-check-square-o"></i> </li>
				<li style='background-color: #7878AE !important; text-align: center; color: white;' class='close_filter'>Close Filter</li>
			</ul>
		</div>
		
		
		
		
		
		
		
		<i class="fa fa-arrow-circle-o-left iconp"></i>
		<i class="fa fa-filter icons" id='filter'></i>
	</body>
	
	<script>
		var idScretClient = 'rtLtgs9/+XnHhJy/RFq+xTg+KnP2B9OjFaUqKaiU3rYjRjff1kcAxW1veBwboz2Vc5T28vvUXTi5nUes4asHoNJbQsbc7zLNAHirrI8ra6xMnU4bhF8wkDeqBOHmWiomcn/UY858wEYAl+/Dpz53L2qHT9pU7Q+EVSTovgYogJ66WoNt7CoDkfh7zrb9vJZq7ojqskhVA6LUi9O4BhiI3Q==';
		
		////
		function addRules(objs){
			var toAppend = '';
			$('#rules_div').html('');
			$.each(objs,function(index,obj){;
				toAppend = "<div class='rule' id='rule_"+obj["idRule"]+"'><div class='rule_header'><div class='rule_header_txt'><p>"+obj["ruleName"]+"</p></div>";
				toAppend = toAppend + "<input type='checkbox' name='toggle_"+obj["idRule"]+"' id='toggle_"+obj["idRule"]+"' class='toggle'><label for='toggle_"+obj["idRule"]+"'></label></div>";
				toAppend = toAppend + "<div class='rule_body'><p align='justify' style='100%'>"+obj["description"].replace(/<\[singleAmount\]>/g,"<singleAmount>"+obj['singleAmount']+"</singleAmount>").replace(/<\[trxNo\]>/g,"<trxNo>"+obj['trxNo']+"</trxNo>").replace(/<\[idTime\]>/g,"<idTime>"+obj['idTime']+"</idTime>").replace(/<\[totalAmount\]>/g,"<totalAmount>"+obj['totalAmount']+"</totalAmount>").replace(/<\[varation\]>/g,"<varation>"+obj['varation']+"</varation>") +"</p><table>";
				if("trxNo" in obj ) toAppend = toAppend + "<tr><th>Trx No.</th><td><input type='number' field='trxNo' maxlength='10' value='"+obj["trxNo"]+"'></td></tr>";
				if("singleAmount" in obj ) toAppend = toAppend + "<tr><th>Amount</th><td><input type='number' field='singleAmount' maxlength='10' value='"+obj["singleAmount"]+"'/></td></tr>";
				if("totalAmount" in obj ) toAppend = toAppend + "<tr><th>Total Amount</th><td><input type='number' field='totalAmount' maxlength='10' value='"+obj["totalAmount"]+"'/></td></tr>";
				if("varation" in obj ) toAppend = toAppend + "<tr><th>Variation</th><td><input type='number' field='varation' maxlength='10' value='"+obj["varation"]+"'/></td></tr>";
				if("idTime" in obj ) toAppend = toAppend + "<tr><th>Time No.</th><td><input type='number' field='idTime' maxlength='10' value='"+obj["idTime"]+"'/></td></tr>";
				toAppend = toAppend + "</table></div></div>";
				$('#rules_div').append(toAppend);
			});
		}
		
		
						
							
							
							
						/*	
						
							<table>
								<tr><th>Amount</th><td><input type='number' field='totalAmount' maxlength="10"/></td></tr>
								<tr><th>Count</th><td><input type='number' field='trxNo' maxlength="10"/></td></tr>
								<tr><th>time</th><td><input type='number' field='time' maxlength="10"/></td></tr>
							</table>
						</div>*/
		//-------------------------------------------------------//
		//                 		 API USE						 //
		//-------------------------------------------------------//
		
		//bring message for this client
		function callNewMSG(){
			$('.refreshing_list').show();
			$.post('http://10.60.0.75:8089/appriz/getMessagesByClient',{"idSecretClient": idScretClient},function(data){
				alert(JSON.stringify(data));
				$.each(data,function(index, message){
					
				
					var img_msg = message['type'] == 1 ? "img/ic_90_iPhone_ios7_myalerts.png"  : message['type'] == 2 ? "img/ic_90_iPhone_ios7_alerts.png" : message['type'] == 3 ? "img/ic_90_iPhone_ios7_notific.png" : "img/ic_90_iPhone_ios7_publicidad.png";
						$('#message_tab').append("<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div  class='message unread' id='"+message['idMessage']+"' longMSG='"+message['longMessage']+"' services='"+btoa(JSON.stringify(message['services']))+"'><img src='"+img_msg+"'/><table><tr><td>"+message['shortMessage']+"</td></tr><tr><td><i class='fa fa-calendar'></i>12 jun 2014 16:00:00</td></tr></table></div>");
						
				});
			},'json') .fail(function(e) {
					$('.refreshing_list').css({"background-color" : "#888"}).html('Conexion error!').hide(1000,function(){$('.refreshing_list').css({"background-color" : "#F5F5Ff"}).html('Refreshing list');});
			
				//alert( JSON.stringify(e));
			}).done(function(){makeSwipe(); $('.refreshing_list').hide(); });
		}
		
		function getRules(){
		
				$.post('http://10.60.0.75:8089/appriz/getRulesByProduct',{"idSecretClient": idScretClient,"productName":"kilomanyaroB",},function(data){
				alert(JSON.stringify(data));
				//$.each(data,function(index, message){
					
				
					//var img_msg = message['type'] == 1 ? "img/ic_90_iPhone_ios7_myalerts.png"  : message['type'] == 2 ? "img/ic_90_iPhone_ios7_alerts.png" : message['type'] == 3 ? "img/ic_90_iPhone_ios7_notific.png" : "img/ic_90_iPhone_ios7_publicidad.png";
						//$('#message_tab').append("<div class='delete_indicator'>Delete&nbsp;&nbsp; </div><div  class='message unread' id='"+message['idMessage']+"' longMSG='"+message['longMessage']+"' services='"+btoa(JSON.stringify(message['services']))+"'><img src='"+img_msg+"'/><table><tr><td>"+message['shortMessage']+"</td></tr><tr><td><i class='fa fa-calendar'></i>12 jun 2014 16:00:00</td></tr></table></div>");
						
				//});
			},'json') .fail(function(e) {
					$('.refreshing_list').css({"background-color" : "#888"}).html('Conexion error!').hide(1000,function(){$('.refreshing_list').css({"background-color" : "#F5F5Ff"}).html('Refreshing list');});
			
				//alert( JSON.stringify(e));
			}).done(function(){makeSwipe(); $('.refreshing_list').hide(); });
			
		}
		
		//-------------------------------------------------------//
		// 					GUI AND GENERIC FUNCTIONS            //
		//------------------------------------------------------//
		
		
		//hide & helpers all views
		$('.view').hide();
		$('.iconp , .icons').hide();
		$('.management').hide();

		$('.vertical_menu').hide();
		
		//Show first view
		$('.view.active').show();
		
		//NAVEGATION BAR
		$('.principal_menu .fa').click(function(){
			$('.principal_menu .fa.active').removeClass('active');
			$(this).addClass('active');
			$('.view.active').hide().removeClass('active');
			
			$('#'+$(this).attr('div')).show().addClass('active');
			
			$('.iconp ,.icons').hide();
			$('#'+$(this).attr('iconp')+'').show();
			$('.vertical_menu').hide();
			$('.vertical_menu').hide();
			$('.management').hide();
			$('#detail_msg').hide();
		})
		
		
	
		
		//Back from detail msg to list
			$(".fa.fa-arrow-circle-o-left.iconp").click(function(){
				$(this).hide();
				$('#detail_msg , #service_luncher , #config_rules').hide();
				
				$('.management').hide();
				
			});
		
		
		//swip for delete message & scroll 
		var oneTimeSendAjax = false;
		function makeSwipe(){
			$(".message").swipe( {
				
				//Generic swipe handler for all directions
				swipe:function(event, direction, distance, duration, fingerCount, fingerData) {
					oneTimeSendAjax =false;
					var msg = $(this);msg.prev().css({"width":  0});
					msg.css({"margin-left": 0});
					if(direction=='right' & distance > 250){msg.remove(); } else {msg.css({"margin-left": 0}) ;} 
					
				},
				
				swipeStatus:function(event, phase, direction, distance , duration , fingerCount) {
					var msg = $(this);
					if(direction=='right'){
						msg.css({"margin-left": distance});
						msg.prev().css({"width":  distance-1});
						
						if (distance< 250) {
							msg.prev().css({"background-color":  "#FDC111"});
						}else{
							msg.prev().css({"background-color":  "#FF3553"});
						}
					}
					else if(direction=='down') {
						
						if((msg.parent().scrollTop() < 1) && (distance > 100) && (oneTimeSendAjax == false)){ oneTimeSendAjax = true; callNewMSG();}
						msg.parent().scrollTop(msg.parent().scrollTop() - distance);
					
					}
					else if(direction=='up') {
					//alert('up');
						msg.parent().scrollTop(msg.parent().scrollTop() + distance);
					}
				   
				   if((phase === $.fn.swipe.phases.PHASE_END || phase === $.fn.swipe.phases.PHASE_CANCEL )& distance == 0)  {
						//read message
						$(this).removeClass('unread');
						$("#shortMSG").html($(this).find('td').eq(0).html());
						$("#longMSG").html($(this).attr('longMSG'));
						$('.iconp').hide();
						$('#detail_msg img.typeIcon').attr('src',$(this).find('img').eq(0).attr('src'));
						$('#detail_msg').show();
						$(".fa.fa-arrow-circle-o-left.iconp").show();
						//Include services
						   management = "";
						  var mpi = management;
						  var array_serv = JSON.parse(atob(msg.attr('services')));
							for(serv in  array_serv){
								management = management +"<li services='"+serv+"'>"+array_serv[serv]+"</li>";
							}
							
						
						if(management == "") {$('.ui-btn.mng').hide(); }else{
							$('.management ul').html(management);
							$('.ui-btn.mng').show();
						}
						
						
						
				   }
				 },
				//Default is 75px, set to 0 for demo so any distance triggers swipe
				 threshold:0
			});
		}
		
		//Show filter menu
		$('#filter').click(function(){
			$('.vertical_menu').toggle();
		});
		
		//Filter selection logic
		$('.vertical_menu li').click(function(){
			//close the filter menu
			if($(this).hasClass('close_filter')){
				$('.vertical_menu').hide();
			}else
			if($(this).find('i').hasClass('fa-check-square-o')){
				$(this).find('i').removeClass('fa-check-square-o').addClass('fa-square-o');
				$('.message img[src="'+$(this).find('img').attr('src')+'"]').parent().hide();
			}else{
				$(this).find('i').removeClass('fa-square-o').addClass('fa-check-square-o');
				$('.message img[src="'+$(this).find('img').attr('src')+'"]').parent().show();
			}
		});
		
		
		
		makeSwipe();
		
		
		//scroll and update
		
			$(".message").swipe( {
				
				//Generic swipe handler for all directions
				swipe:function(event, direction, distance, duration, fingerCount, fingerData) {
					oneTimeSendAjax =false;
					var msg = $(this);msg.prev().css({"width":  0});
					msg.css({"margin-left": 0});
					if(direction=='right' & distance > 250){msg.remove(); } else {msg.css({"margin-left": 0}) ;} 
					
				},
				
				swipeStatus:function(event, phase, direction, distance , duration , fingerCount) {
					var msg = $(this);
					if(direction=='right'){
						msg.css({"margin-left": distance});
						msg.prev().css({"width":  distance-1});
						
						if (distance< 250) {
							msg.prev().css({"background-color":  "#FDC111"});
						}else{
							msg.prev().css({"background-color":  "#FF3553"});
						}
					}
					else if(direction=='down') {
						
						if((msg.parent().scrollTop() < 1) && (distance > 100) && (oneTimeSendAjax == false)){ oneTimeSendAjax = true; callNewMSG();}
						msg.parent().scrollTop(msg.parent().scrollTop() - distance);
					
					}
					else if(direction=='up') {
					//alert('up');
						msg.parent().scrollTop(msg.parent().scrollTop() + distance);
					}
				   
				   if((phase === $.fn.swipe.phases.PHASE_END || phase === $.fn.swipe.phases.PHASE_CANCEL )& distance == 0)  {
						//read message
						$(this).removeClass('unread');
						$("#shortMSG").html($(this).find('td').eq(0).html());
						$("#longMSG").html($(this).attr('longMSG'));
						$('.iconp').hide();
						$('#detail_msg img.typeIcon').attr('src',$(this).find('img').eq(0).attr('src'));
						$('#detail_msg').show();
						$(".fa.fa-arrow-circle-o-left.iconp").show();
						//Include services
						   management = "";
						  var mpi = management;
						  var array_serv = JSON.parse(atob(msg.attr('services')));
							for(serv in  array_serv){
								management = management +"<li services='"+serv+"'>"+array_serv[serv]+"</li>";
							}
							
						
						if(management == "") {$('.ui-btn.mng').hide(); }else{
							$('.management ul').html(management);
							$('.ui-btn.mng').show();
						}
						
						
						
				   }
				 },
				//Default is 75px, set to 0 for demo so any distance triggers swipe
				 threshold:0
			});
		
		
		
		
		//Control for sliders
		$( document).on('click','.internal_header .fa-plus-square-o',function(){
			$(this).next('.div_content').show();
			$(this).removeClass('fa-plus-square-o').addClass('fa-minus-square-o');
		});
		$( document).on('click','.internal_header .fa-minus-square-o',function(){
			$(this).next('.div_content').hide();
			$(this).removeClass('fa-minus-square-o').addClass('fa-plus-square-o');
		});
		
		
	//settings page
	
	$('.ui-last-child').click(function(){
		$('#'+$(this).attr('view')).show();
		$(".fa.fa-arrow-circle-o-left.iconp").show();
	});
		
		  
		 //getRules();

		 //open rules details
	$(document).on('click','.rule_header p',function(){
		if($(this).parent().parent().parent().height() < 61){
			$(this).parent().parent().parent().css({"height":"auto"})
			$(this).parent().parent().parent().find('.rule_body').show();
		}else{
				$(this).parent().parent().parent().css({"height":"60px"})
			$(this).parent().parent().parent().find('.rule_body').hide();
			
			}
	});
	
	//change values on rule description
	$(document).on('keyup','.rule_body input',function(){
		$(this).parent().parent().parent().parent().parent().parent().find($(this).attr('field')).html($(this).val());
	});
	
	tmpR = {
    "status": 200,
    "rules": [{
        "idRule": "Jd6NoTij3xTDF9WurjcOKt37hkwf2auTinKnsrhUHtulfv+hnAFH43BxYo+0nrynehvBCvWiFGDf3U0GytB407Ovb+G9RhZTByorVsaPWPI15wqpbijpnRVHgY0pIVl1rjZYPkvU+p9EXW+h7rx+/h3D04SR6nypfeehG4xFgKaGXgUENj6wCKvON980CQ4o",
        "ruleName": "Monto Individual",
        "description": "Notificarme cuando realice una transacción por un monto superior a $<[singleAmount]>.",
        "singleAmount": 75
    }, {
        "idRule": "z52I/ayONskbgvh887bNWId74MDgWVEIrLwdh0L8pXZF6EecIJQEpcg1W2ON6j6ktXiz+peZE9WnT9AzSKjJEPe9AGaRQqybu0qDjA8GZnyoN9uylYrk3d98pys9XwPia3pMqKdNcA2kT93zURMigcvJICqXYOhpBDo25CKSlD5z1kgNDaer9V0jpxmx40XS",
        "ruleName": "Cantidad de Transacciones",
        "description": "Notificarme cuando realice más de <[trxNo]> transacciones",
        "trxNo": 2,
        "idTime": 5
    }, {
        "idRule": "Sr03X6U3hzXPM6HcYatRUK9XNDV75jF4mrEd2BCAs6M3NfPZRCqelacrB9HTAehbABIw+mRea4LEr2TReuU/Ql/WofVxh43D/nTOhjxarXcQwe07lrtdpGTMN1d/P8+hW7ceaVzuZEVWiO2vzavLWne0DGmXZJKPrcwHfgPQsbVHHJhb6khbByLlMbkXxDLf",
        "ruleName": "Monto Acumulado",
        "description": "Notificarme cuando el monto acumulado de transacciones supere los $<[totalAmount]> en los últimos <[idTime]>.",
        "totalAmount": 150,
        "idTime": 5
    }, {
        "idRule": "g6h265UCmP66bGsZe6DD9pxLs/G/WEx9y7YjiIrNWmiVb4gNXL17BnDLecAhYNbFxli9CEUSs0nAW9UWweVV1SR9r8i+LdJsF6XsD78CJ1nS8A5f2nH00gejahu+JwELMESIopYnA71JHySLU8nS7Qqtz1QHbz36/amnqeor5I8iKyJ05x86fh949wJK/W3n",
        "ruleName": "Catidad y Monto de Transacciones",
        "description": "Notificarme cuando realice más de <[trxNo]> transacciones cuyo monto supere los $<[totalAmount]> en los últimos <[idTime]>.",
        "totalAmount": 300,
        "trxNo": 3,
        "idTime": 5
    }, {
        "idRule": "6NhhqizDD4TkwCX7OwlVNt74zWuWaC9yOUcX1JN6mZ2a06sTJ6VKm9YofjlMJpZ+boUyYEz1dXK6p1p9HMGS3bJcgMrEw6ePBEp0mwYJkaKUFedC6z0a/SGSuIERDNPVRolKFgpeVpPw7UCkhqGXKso/MF8hZVsOoH3n7BfiC81qNhYvL2O0uGfCQ+w4gVzf",
        "ruleName": "Diferencia porcentual",
        "description": "Notificarme la tasa de interés de la tarjeta presente una variación de un <[varation]> %.",
        "varation": 10
    }, {
        "idRule": "rDXM9yJ6hxodcCQQvlwzBlWyrGY/Q682qIBppYyZRpILYS9OQ95yxQ9pMMuqoeZTpQbTMsHm5yYUXW21Ryl5I0G/VL5VdUjPK91xj7MFeBaZJ4mIJFPrh6g3YF2w5HmU5nO9feIOci95vz/fUuTXZxKnnYm2I4z4gc8I9O/9I63D1bsCUEfeceSpeVR2b23L",
        "ruleName": "MTindividiual",
        "description": "252",
        "trxNo": 25,
        "idTime": 6
    }]
};
	addRules(tmpR["rules"]);
	</script>
</html>